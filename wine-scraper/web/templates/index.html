<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wine Selector - Theme Browser</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow">
            <div class="max-w-7xl mx-auto px-4 py-6">
                <h1 class="text-3xl font-bold text-gray-900">Wine Selector</h1>
                <p class="mt-2 text-gray-600">Intelligent wine selection from {{ stats.total_wines|default('13M') }} wines</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-8">
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-2xl font-bold text-gray-900">{{ stats.total_wines|default('N/A') }}</div>
                    <div class="text-sm text-gray-600">Total Wines</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-2xl font-bold text-gray-900">{{ stats.total_countries|default('N/A') }}</div>
                    <div class="text-sm text-gray-600">Countries</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-2xl font-bold text-gray-900">{{ stats.total_regions|default('N/A') }}</div>
                    <div class="text-sm text-gray-600">Regions</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-2xl font-bold text-gray-900">{{ stats.avg_rating|default('N/A') }}</div>
                    <div class="text-sm text-gray-600">Average Rating</div>
                </div>
            </div>

            <!-- Theme Grid -->
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Pre-defined Themes</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for theme in themes %}
                    <div class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow">
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-2">{{ theme.name }}</h3>
                            <p class="text-gray-600 mb-4">{{ theme.description }}</p>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-500">{{ theme.wine_count }} wines</span>
                                <a href="/theme/{{ theme.name }}" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition-colors">
                                    Select Wines
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Search Section -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Search Wines</h2>
                <form id="searchForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                            <input type="text" name="country" placeholder="e.g., France" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Region</label>
                            <input type="text" name="region" placeholder="e.g., Burgundy" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Grapes</label>
                            <input type="text" name="grapes" placeholder="e.g., Pinot Noir" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Min Rating</label>
                            <input type="number" name="min_rating" step="0.1" min="0" max="5" placeholder="e.g., 4.0" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Max Price ($)</label>
                            <input type="number" name="max_price" step="1" min="0" placeholder="e.g., 50" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Wine Type</label>
                            <select name="wine_type" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="">All Types</option>
                                <option value="red">Red</option>
                                <option value="white">White</option>
                                <option value="rosé">Rosé</option>
                                <option value="sparkling">Sparkling</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700 transition-colors">
                            Search
                        </button>
                    </div>
                </form>

                <!-- Search Results -->
                <div id="searchResults" class="mt-6 hidden">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">Search Results</h3>
                    <div id="resultsContainer" class="space-y-4"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const params = new URLSearchParams();

            for (const [key, value] of formData.entries()) {
                if (value) params.append(key, value);
            }

            try {
                const response = await fetch(`/api/search?${params}`);
                const data = await response.json();

                const resultsDiv = document.getElementById('searchResults');
                const containerDiv = document.getElementById('resultsContainer');

                if (data.success && data.wines.length > 0) {
                    containerDiv.innerHTML = data.wines.map(wine => `
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="font-bold text-gray-900">${wine.name} ${wine.vintage ? `(${wine.vintage})` : ''}</div>
                            <div class="text-sm text-gray-600 mt-1">${wine.winery || 'N/A'} - ${wine.region || 'N/A'}, ${wine.country || 'N/A'}</div>
                            <div class="text-sm text-gray-500 mt-1">
                                Rating: ${wine.rating || 'N/A'}/5 |
                                Price: $${wine.price_usd || 'N/A'} |
                                Type: ${wine.wine_type || 'N/A'}
                            </div>
                        </div>
                    `).join('');
                    resultsDiv.classList.remove('hidden');
                } else {
                    containerDiv.innerHTML = '<div class="text-gray-600">No wines found matching criteria</div>';
                    resultsDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Search error:', error);
                alert('Search failed. Please try again.');
            }
        });
    </script>
</body>
</html>
